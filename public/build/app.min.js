var app=angular.module("AutoMobileTn",["ui.router","ngAnimate","toastr","datatables","ui.bootstrap","ngSweetAlert","ngMap","vcRecaptcha","pascalprecht.translate","ngCookies","blockUI","ezfb"]);app.config(["$urlRouterProvider","$urlMatcherFactoryProvider","$stateProvider","$httpProvider","$locationProvider","toastrConfig","$qProvider","$translateProvider","blockUIConfig","ezfbProvider",function(t,e,n,a,r,o,s,i,c,l){c.autoBlock=!1,i.useStaticFilesLoader({prefix:"/public/app/translations/",suffix:".json"}).preferredLanguage("ar").useLocalStorage().useMissingTranslationHandlerLog().useSanitizeValueStrategy("escapeParameters"),s.errorOnUnhandledRejections(!1),a.interceptors.push(["$q","$location",function(t,e){return{response:function(t){return t},responseError:function(n){return 404==n.status&&e.url("/error"),401===n.status&&e.url("/login"),403===n.status&&e.url("/logout"),t.reject(n)}}}]),t.otherwise("/error"),r.html5Mode(!0),n.state("home",{url:"/",templateUrl:"/public/views/core/home.html",controller:"homeController"}).state("marque_car",{url:"/marque/:marque",templateUrl:"/public/views/core/car.marque.html",controller:"marqueController"}).state("new_cars",{url:"/cars/new",templateUrl:"/public/views/core/car.marque.html",controller:"carsController"}).state("search",{url:"/search?marque&model&year&price&transmission&condition",templateUrl:"/public/views/core/car.marque.html",controller:"searchController"}).state("old_cars",{url:"/cars/old",templateUrl:"/public/views/core/car.marque.html",controller:"carsController"}).state("login",{url:"/login",templateUrl:"/public/views/auth/login.html",controller:"loginController"}).state("logout",{url:"/logout",controller:"logoutController"}).state("contact",{url:"/contact",templateUrl:"/public/views/core/contact.html",controller:"contactController"}).state("admin",{url:"/admin",controller:"dashboardController",templateUrl:"/public/views/admin/dashboard.html",data:{authenticate:!0}}).state("newCar",{url:"/admin/car/new",templateUrl:"/public/views/admin/new.car.html",controller:"newCarController",data:{authenticate:!0}}).state("editCar",{url:"/admin/car/:id/edit",templateUrl:"/public/views/admin/edit.car.html",controller:"editCarController",resolve:{car:["$rootScope","$http","API_ENDPOINT","$stateParams","$state",function(t,e,n,a,r){return e.get(n.url+"/car/"+a.id).then(function(e){return $("#meta-title").attr("content",car.titre),t.show_car_title=e.data.titre,e.data.images.length>0?$("#meta-image").attr("content",e.data.images[0]):$("#meta-image").attr("content",n.domain+"public/assets/img/no_image.png"),e.data},function(){r.go("error")})}]},data:{authenticate:!0}}).state("admin_old_cars",{url:"/admin/old-cars",templateUrl:"/public/views/admin/list.cars.html",controller:"carListController",data:{authenticate:!0}}).state("admin_new_cars",{url:"/admin/new-cars",templateUrl:"/public/views/admin/list.cars.html",controller:"carListController",data:{authenticate:!0}}).state("show_car",{url:"/car/:id/detail",templateUrl:"/public/views/core/show_car.html",controller:"showCarController",resolve:{car:["$http","API_ENDPOINT","$stateParams","$state",function(t,e,n,a){return t.get(e.url+"/car/"+n.id).then(function(t){return t.data},function(){a.go("error")})}]}}).state("messages",{url:"/admin/messages",templateUrl:"/public/views/admin/messages.html",controller:"messagesController",data:{authenticate:!0}}).state("settings",{url:"/admin/settings",templateUrl:"/public/views/admin/settings.html",controller:"settingsController",data:{authenticate:!0}}).state("marques",{url:"/admin/marques",templateUrl:"/public/views/admin/marques.html",controller:"marquesController",data:{authenticate:!0}}).state("error",{url:"/error",templateUrl:"/public/views/core/error.html"}),angular.extend(o,{autoDismiss:!1,containerId:"toast-container",maxOpened:0,newestOnTop:!0,positionClass:"toast-top-left",preventDuplicates:!1,preventOpenDuplicates:!1,target:"body"}),l.setLocale("fr_FR"),l.setInitParams({appId:"254799621627740",version:"v2.8"})}]).run(["$rootScope","authService","$state",function(t,e,n){t.isLoading=!0,t.$on("$stateChangeStart",function(a,r){t.isLoading=!0,null==r.data&&e.isAuthenticated()&&(t.isLoading=!0,e.logout()),r.data&&r.data.authenticate&&!e.isAuthenticated()&&(a.preventDefault(),n.go("login")),e.isAuthenticated()?(t.stylesheet="/public/assets/css/admin.css",t.authenticated=!0):t.stylesheet="/public/assets/css/main.css",t.$on("$stateChangeSuccess",function(e,n){"logout"!=n.name&&(t.isLoading=!1),document.body.scrollTop=document.documentElement.scrollTop=0})})}]),app.constant("AUTH_EVENTS",{notAuthenticated:"auth-not-authenticated"}).constant("API_ENDPOINT",{url:"https://auto-mobile-tn.herokuapp.com/api",domain:"https://auto-mobile-tn.herokuapp.com/"}).constant("GOVERNORATE",["Monastir","Sousse","Tunis","Gafsa","Mahdia","Sidi Bouzid","Ariana","Jendouba","Manouba","Siliana","Béja","Kairouan","Médenine","Ben Arous","Kasserine","Tataouine","Bizerte","Kébili","Nabeul","Tozeur","Gabès","Le Kef","Sfax","Zaghouan"]),app.controller("dashboardController",["$rootScope","authService","$http","API_ENDPOINT","$timeout",function(t,e,n,a,r){t.unseen=0,n.get(a.url+"/admin/notification").then(function(e){t.notifications=e.data,angular.forEach(e.data,function(e,n){e.seen||(t.unseen+=1)})}),n.get(a.url+"/admin/car/count").then(function(e){t.allCars=e.data.number}),t.setNotificationSeen=function(){t.unseen>0&&n.post(a.url+"/admin/notification/seen").then(function(){r(function(){t.unseen=0},2e3)})}}]).controller("newCarController",["$scope","$http","API_ENDPOINT","toastr","$state","$translate","blockUI","$timeout",function(t,e,n,a,r,o,s,i){t.initCar=function(){t.car={},t.car.images=[],t.car.security={},t.car.fonctional={},$(".input-image").each(function(){$(this).val("")}),t.marque=null},t.initCar(),e.get(n.url+"/marques").then(function(e){t.marques=e.data}),t.$watch("marque",function(e){e&&(t.models=JSON.parse(e).models)}),t.addCar=function(){s.start(o.instant("TOAST_WAIT_MESSAGE")+"......"),$(".input-image").each(function(){$(this).val().length>5&&t.car.images.push($(this).val())}),t.car.marque=JSON.parse(t.marque).nom,e.post(n.url+"/admin/car/new",t.car).then(function(){a.success(o.instant("CAR_TOAST_ADD_DONE"),o.instant("CAR_TOAST_ADD")),t.initCar(),s.stop()},function(){a.error(o.instant("SYSTEM_FAIL"),o.instant("CHANGE_PASSWORD")),s.stop()})}}]).controller("editCarController",["car","$scope","$http","API_ENDPOINT","toastr","$state","$translate","blockUI","$timeout",function(t,e,n,a,r,o,s,i,c){e.car=angular.copy(t),e.initCar=function(){e.car.images=[],e.car=angular.copy(t)},e.removeImage=function(t){e.car.images.splice(t,1)},n.get(a.url+"/marques").then(function(n){e.marques=n.data,angular.forEach(e.marques,function(n,a){n.nom==t.marque&&(e.marque=n,e.models=n.models)})}),e.$watch("car.marque",function(t){angular.forEach(e.marques,function(n){n.nom==t&&(e.models=n.models)})}),e.editCar=function(){i.start(s.instant("TOAST_WAIT_MESSAGE")+"......."),$(".input-image").each(function(){$(this).val().length>5&&e.car.images.push($(this).val())}),n.post(a.url+"/admin/car/update",e.car).then(function(){r.success(s.instant("CAR_TOAST_EDIT_DONE"),s.instant("CAR_TOAST_EDIT")),i.stop()},function(){r.error(s.instant("SYSTEM_FAIL"),s.instant("CAR_TOAST_EDIT")),i.stop()})}}]).controller("carListController",["$scope","DTOptionsBuilder","SweetAlert","$http","API_ENDPOINT","$state","$translate",function(t,e,n,a,r,o,s){"admin_new_cars"==o.current.name?(t.NEWCARS=!0,a.get(r.url+"/new-cars").then(function(e){t.cars=e.data})):(t.OLDCARS=!0,a.get(r.url+"/old-cars").then(function(e){t.cars=e.data}));var i={sProcessing:s.instant("TABLE_LANG.sProcessing"),sSearch:s.instant("TABLE_LANG.sSearch"),sLengthMenu:s.instant("TABLE_LANG.sLengthMenu"),sInfo:s.instant("TABLE_LANG.sInfo"),sInfoEmpty:s.instant("TABLE_LANG.sInfoEmpty"),sInfoFiltered:s.instant("TABLE_LANG.sInfoFiltered"),sInfoPostFix:"",sLoadingRecords:s.instant("TABLE_LANG.sLoadingRecords"),sZeroRecords:s.instant("TABLE_LANG.sZeroRecords"),oPaginate:{sFirst:s.instant("TABLE_LANG.oPaginate.sFirst"),sPrevious:s.instant("TABLE_LANG.oPaginate.sPrevious"),sNext:s.instant("TABLE_LANG.oPaginate.sNext"),sLast:s.instant("TABLE_LANG.oPaginate.sLast")}};t.dtOptions=e.newOptions().withPaginationType("full_numbers").withDisplayLength(10).withOption("order",[1,"desc"]).withLanguage(i),t.deleteCar=function(e,o){n.swal({title:s.instant("SWEETALERT_CONFIRM"),text:s.instant("CAR_SWEETALERT_DELETE_QUESTION"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:s.instant("SWEETALERT_DELETE_OK"),cancelButtonText:s.instant("SWEETALERT_DELETE_CANCEL"),closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(i){return i&&a.post(r.url+"/admin/car/delete",{id:e._id}).then(function(){n.swal("",s.instant("CAR_SWEETALERT_DELETE_DONE"),"success"),t.cars.splice(o,1)},function(){n.swal("",s.instant("SYSTEM_FAIL"),"error")}),!1})}}]).controller("messagesController",["$rootScope","$scope","authService","$http","API_ENDPOINT","DTOptionsBuilder","$uibModal","toastr","SweetAlert","$translate",function(t,e,n,a,r,o,s,i,c,l){a.get(r.url+"/admin/contacts").then(function(t){e.contacts=t.data});var u={sProcessing:l.instant("TABLE_LANG.sProcessing"),sSearch:l.instant("TABLE_LANG.sSearch"),sLengthMenu:l.instant("TABLE_LANG.sLengthMenu"),sInfo:l.instant("TABLE_LANG.sInfo"),sInfoEmpty:l.instant("TABLE_LANG.sInfoEmpty"),sInfoFiltered:l.instant("TABLE_LANG.sInfoFiltered"),sInfoPostFix:"",sLoadingRecords:l.instant("TABLE_LANG.sLoadingRecords"),sZeroRecords:l.instant("TABLE_LANG.sZeroRecords"),oPaginate:{sFirst:l.instant("TABLE_LANG.oPaginate.sFirst"),sPrevious:l.instant("TABLE_LANG.oPaginate.sPrevious"),sNext:l.instant("TABLE_LANG.oPaginate.sNext"),sLast:l.instant("TABLE_LANG.oPaginate.sLast")}};e.dtOptions=o.newOptions().withPaginationType("full_numbers").withDisplayLength(10).withOption("order",[1,"desc"]).withLanguage(u),e.openMessageModal=function(e){t.messageModal=s.open({animation:!0,templateUrl:"messageModal.html",size:"lg",controller:["$scope",function(n){n.contact=e,n.openSendModal=function(e){t.messageModal.close("a"),t.sendModal=s.open({animation:!0,templateUrl:"sendModal.html",size:"lg",controller:["$scope",function(n){n.contact=e,n.message="",n.sendMessage=function(){i.info(l.instant("MESSAGE_TOAST_SEND_EMAIL_WAIT"),l.instant("NAVBAR_CONTACT"),{progressBar:!0}),a.post(r.url+"/admin/contact/replay",{email:e.email,message:n.message,title:n.title,name:e.name}).then(function(){t.sendModal.dismiss("cancel"),i.clear(),i.success(l.instant("MESSAGE_TOAST_SEND_EMAIL_DONE"),l.instant("NAVBAR_CONTACT"))},function(t){i.error(l.instant("SYSTEM_FAIL"),l.instant("NAVBAR_CONTACT"))})},n.closeSendModal=function(){t.sendModal.dismiss("cancel")}}]})}}]})},e.deleteMessage=function(t,n){c.swal({title:l.instant("SWEETALERT_CONFIRM"),text:l.instant("MESSAGE_SWEETALERT_DELETE_QUESTION"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:l.instant("SWEETALERT_DELETE_OK"),cancelButtonText:l.instant("SWEETALERT_DELETE_CANCEL"),closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(o){return o&&(console.log(t),a.post(r.url+"/admin/contact/delete",{id:t._id}).then(function(){c.swal("",l.instant("MESSAGE_SWEETALERT_DELETE_DONE"),"success"),e.contacts.splice(n,1)},function(){c.swal("",l.instant("SYSTEM_FAIL"),"error")})),!1})}}]).controller("settingsController",["$scope","$http","API_ENDPOINT","toastr","$translate",function(t,e,n,a,r){t.password={},t.changePassword=function(){e.post(n.url+"/admin/reset-password",t.password).then(function(t){0==t.data.error&&a.success(r.instant("CHANGE_PASSWORD_DONE"),r.instant("CHANGE_PASSWORD")),1==t.data.error&&a.error(r.instant("CHANGE_PASSWORD_WRONG_OLD"),r.instant("CHANGE_PASSWORD")),2==t.data.error&&a.error(r.instant("CHANGE_PASSWORD_WRONG_CONFIRM"),r.instant("CHANGE_PASSWORD"))},function(){a.error(r.instant("SYSTEM_FAIL"),r.instant("CHANGE_PASSWORD"))})}}]).controller("marquesController",["$scope","$http","API_ENDPOINT","$compile","DTOptionsBuilder","$translate","toastr","SweetAlert",function(t,e,n,a,r,o,s,i){t.models=[],e.get(n.url+"/marques").then(function(e){t.marques=e.data,angular.forEach(t.marques,function(e){angular.forEach(e.models,function(n){t.models.push({marque:e,nom:n})})})});var c={sProcessing:o.instant("TABLE_LANG.sProcessing"),sSearch:o.instant("TABLE_LANG.sSearch"),sLengthMenu:o.instant("TABLE_LANG.sLengthMenu"),sInfo:o.instant("TABLE_LANG.sInfo"),sInfoEmpty:o.instant("TABLE_LANG.sInfoEmpty"),sInfoFiltered:o.instant("TABLE_LANG.sInfoFiltered"),sInfoPostFix:"",sLoadingRecords:o.instant("TABLE_LANG.sLoadingRecords"),sZeroRecords:o.instant("TABLE_LANG.sZeroRecords"),sEmptyTable:o.instant("TABLE_LANG.sEmptyTable"),oPaginate:{sFirst:o.instant("TABLE_LANG.oPaginate.sFirst"),sPrevious:o.instant("TABLE_LANG.oPaginate.sPrevious"),sNext:o.instant("TABLE_LANG.oPaginate.sNext"),sLast:o.instant("TABLE_LANG.oPaginate.sLast")}};t.dtOptions=r.newOptions().withPaginationType("full_numbers").withDisplayLength(10).withOption("order",[1,"desc"]).withLanguage(c),$("#btnAddMarque").click(function(){$("#tableMarque tbody").prepend(a("<tr><td colspan='2'><input id='vMai' ng-model='newMarque' placeholder='{{\"ADD_MARQUE_PLACEHOLDER\"|translate}}' class='form-control' type='text'></td><td><button ng-disabled='newMarque.length<1' ng-class='newMarque ?\"\":\"disabled\"' class='btn btn-primary' ng-click='addMarque()'>{{'SAVE'|translate}} <i class='fa fa-save'>  </i></button><button class='btn btn-warning' onclick='$(this).closest(\"tr\").remove()' >{{'CANCEL'|translate}} <i class='fa fa-times'>  </i></button></td></tr>")(t)),t.$apply()}),$("#btnAddModel").click(function(){$("#tableModel").children("tbody:first").prepend(a("<tr><td><input  id='vMoi' ng-show='marque' ng-model='newModel' placeholder='{{\"ADD_MODEL_PLACEHOLDER\"|translate}}' class='form-control' type='text' ng-required='true'></td><td><select ng-model='marque'  class='form-control select2'><option ng-repeat='mq in marques track by $index' value='{{mq._id}}'>{{mq.nom}}</option></select></td><td><button class='btn btn-primary' ng-disabled='newModel.length<1' ng-class='marque && newModel ?\"\":\"disabled\"' ng-click='addModel()'>{{ 'SAVE'|translate }} <i class='fa fa-save'>  </i></button><button class='btn btn-warning' onclick='$(this).closest(\"tr\").remove()' >{{'CANCEL'|translate}} <i class='fa fa-times'>  </i></button></td></tr>")(t)),t.$apply()}),t.addModel=function(){t.newModel&&t.newModel.length>0?e.post(n.url+"/admin/model/new",{marque_id:t.marque,model_name:t.newModel}).then(function(a){a.data.success?(s.success(o.instant("MODEL_TOAST_ADD_DONE"),o.instant("MODEL_TOAST_ADD")),e.get(n.url+"/marques").then(function(e){t.marques=e.data,t.models=[],angular.forEach(t.marques,function(e){angular.forEach(e.models,function(n){t.models.push({marque:e,nom:n})})})}),t.newModel=""):(t.addModelSuccess=!1,t.addModelError=!0),t.marque=null}):$("#vMoi").addClass("error-input")},t.addMarque=function(){t.newMarque&&t.newMarque.length>0?e.post(n.url+"/admin/marque/new",{nom_marque:t.newMarque}).then(function(a){a.data.success?(s.success(o.instant("MARQUE_TOAST_ADD_DONE"),o.instant("MARQUE_TOAST_ADD")),e.get(n.url+"/marques").then(function(e){t.marques=e.data}),t.newMarque=""):(t.addMarqueSuccess=!1,t.addMarqueError=!0)}):$("#vMai").addClass("error-input")},t.deleteModel=function(a,r){i.swal({title:o.instant("SWEETALERT_CONFIRM"),text:o.instant("MODEL_SWEETALERT_DELETE_QUESTION"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:o.instant("SWEETALERT_DELETE_OK"),cancelButtonText:o.instant("SWEETALERT_DELETE_CANCEL"),closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(s){return s&&e.post(n.url+"/admin/model/delete",{marque_id:r._id,model_name:a.nom}).then(function(){t.models.splice(t.models.indexOf(a),1),i.swal("",o.instant("MODEL_SWEETALERT_DELETE_DONE"),"success")},function(){i.swal("",o.instant("SYSTEM_FAIL"),"error")}),!1})},t.deleteMarque=function(a){i.swal({title:o.instant("SWEETALERT_CONFIRM"),text:o.instant("MARQUE_SWEETALERT_DELETE_QUESTION"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:o.instant("SWEETALERT_DELETE_OK"),cancelButtonText:o.instant("SWEETALERT_DELETE_CANCEL"),closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},function(r){return r&&e.post(n.url+"/admin/marque/delete",a).then(function(){t.marques.splice(t.marques.indexOf(a),1),i.swal("",o.instant("MARQUE_SWEETALERT_DELETE_DONE"),"success"),angular.forEach(t.models,function(e,n){e.marque.nom==a.nom&&t.models.splice(n,1)})},function(){i.swal("",o.instant("SYSTEM_FAIL"),"error")}),!1})}}]),app.controller("loginController",["$scope","$rootScope","authService","$window","API_ENDPOINT","$state","$translate",function(t,e,n,a,r,o,s){n.isAuthenticated()&&o.go("admin"),t.doLogin=function(){t.loading=!0,data=t.login,n.login(data).then(function(){e.isLoading=!0,t.$parent.authenticated=!0,t.loading=!1,o.go("admin")},function(e){2==e?t.errorMessage=s.instant("AUTH_FAIL"):t.errorMessage=s.instant("AUTH_BD_FAIL"),t.loginError=!0,t.loading=!1})}}]).controller("logoutController",["authService","$state","$scope","$window","API_ENDPOINT","$rootScope",function(t,e,n,a,r,o){n.$parent.authenticated=!1,t.logout(),setTimeout(function(){e.go("home")},500)}]),app.controller("appController",["$scope","authService","$http","API_ENDPOINT","$timeout","$translate","$rootScope","$state",function(t,e,n,a,r,o,s,i){s.dateYear=(new Date).getFullYear(),e.isAuthenticated()&&(t.unseen=0,n.get(a.url+"/admin/notification").then(function(e){t.notifications=e.data,angular.forEach(e.data,function(e){0==e.seen&&(t.unseen+=1)})}),t.setNotificationSeen=function(){t.unseen>0&&n.post(a.url+"/admin/notification/seen").then(function(){r(function(){t.unseen=0},2e3)})}),t.zone=i.current.name,t.switchLanguage=function(){"ar"==o.use()?o.use("fr"):o.use("ar")},s.changeLanguage=function(t){o.use(t)},s.$on("$translateChangeSuccess",function(t,e){var n=e.language;s.lang=n,s.dir="ar"===n?"rtl":"ltr",s.default_direction="ar"===n?"-rtl":"",s.opposite_direction="ar"===n?"ltr":"rtl",s.default_float="ar"===n?"right":"left",s.opposite_float="ar"===n?"left":"right"})}]).controller("homeController",["$scope","$http","API_ENDPOINT","$rootScope","$timeout","$state",function(t,e,n,a,r,o){t.currentDate=new Date,t.search={price:"0,200000"},e.get(n.url+"/marques").then(function(e){t.marques=e.data}),t.marque=null,t.$watch("marque",function(e){e&&(t.models=JSON.parse(e).models)}),t.loading=!0,e.get(n.url+"/home").then(function(e){t.loading=!1,t.newCars=e.data.newCars,t.oldCars=e.data.usedCars,r(function(){$(".lightSlider").lightSlider({gallery:!1,slideMove:1,item:3,loop:!0,rtl:"rtl"==a.dir,pager:!1,slideMargin:10,prevHtml:'<div class="swiper-button-prev"><i class="fa fa-angle-left"></i></div>',nextHtml:'<div class="swiper-button-next"><i class="fa fa-angle-right"></i></div>',responsive:[{breakpoint:800,settings:{item:2,slideMove:1,slideMargin:6}},{breakpoint:480,settings:{item:1,slideMove:1}}]})},0),window.resize()}),t.searchCar=function(){t.marque&&(t.search.marque=JSON.parse(t.marque).nom),o.go("search",t.search)}}]).controller("showCarController",["car","$scope","$http","API_ENDPOINT","$state","$rootScope","$timeout",function(t,e,n,a,r,o,s){e.car=t,e.search={},e.marque=null,n.get(a.url+"/related/"+e.car._id).then(function(t){e.other_cars=t.data,s(function(){$(".lightSlider").lightSlider({gallery:!0,slideMove:1,rtl:"rtl"==o.dir,item:1,loop:!0,slideMargin:2,thumbItem:10})},0),window.resize()}),n.get(a.url+"/marques").then(function(t){e.marques=t.data}),e.$watch("marque",function(t){t&&(e.models=JSON.parse(t).models)}),e.searchCar=function(){e.marque&&(e.search.marque=JSON.parse(e.marque).nom),r.go("search",e.search)}}]).controller("marqueController",["$scope","$http","API_ENDPOINT","$stateParams","$state",function(t,e,n,a,r){t.itemsPerPage=9,t.marque=null,t.search={price:"0,200000"},e.get(n.url+"/marques").then(function(e){t.marques=e.data}),t.zone=r.current.name,t.selectedMarque=a.marque,t.$watch("marque",function(e){e&&(t.models=JSON.parse(e).models)}),e.get(n.url+"/marque/"+a.marque).then(function(e){t.cars=e.data,t.totalItems=t.cars.length}),t.currentPage=1,t.maxSize=5,t.$watch("itemsPerPage",function(e){t.currentPage=1}),t.setPage=function(e){t.currentPage=e},t.setPage(t.currentPage),t.pageChanged=function(){t.setPage(t.currentPage),$("html, body").animate({scrollTop:0},1e3)},t.searchCar=function(){t.marque&&(t.search.marque=JSON.parse(t.marque).nom),r.go("search",t.search)}}]).controller("contactController",["$scope","NgMap","$timeout","GOVERNORATE","vcRecaptchaService","toastr","$http","API_ENDPOINT","$translate",function(t,e,n,a,r,o,s,i,c){t.recaptcha={},t.recaptcha.key="6LdcSRQUAAAAAMyYVWuyDYn6eMp29m077xtkAuKS",t.recaptcha.lang=c.use(),t.recaptcha.type="image",t.recaptcha.valid=!1,t.contact={},n(function(){e.getMap("map").then(function(e){t.map=e,google.maps.event.trigger(e,"resize"),t.map.showInfoWindow("bar","marker1")},1e3)}),t.response=null,t.widgetId=null,t.cites=a,t.setResponse=function(e){t.response=e},t.setWidgetId=function(e){t.widgetId=e},t.cbExpiration=function(){r.reload(t.widgetId),t.response=null},t.sendMessage=function(){var e=t.contact.email.length>5&&t.contact.name.length>1&&t.contact.message.length>9;e?(o.success(c.instant("MESSAGE_TOAST_SEND_EMAIL_WAIT"),c.instant("PAGE_CONTACT_SEND_US")),s.post(i.url+"/contact/new",t.contact).then(function(e){e.data.success?(o.clear(),o.success(c.instant("MESSAGE_TOAST_SEND_EMAIL_DONE"),c.instant("PAGE_CONTACT_SEND_US")),t.contact={},r.reload(t.widgetId)):(o.clear(),o.error(c.instant("SYSTEM_FAIL"),c.instant("PAGE_CONTACT_SEND_US")),r.reload(t.widgetId))})):r.reload(t.widgetId)}}]).controller("carsController",["$scope","$http","API_ENDPOINT","$state",function(t,e,n,a){t.marque=null,t.search={price:"0,200000"},e.get(n.url+"/marques").then(function(e){t.marques=e.data}),t.itemsPerPage=9,t.zone=a.current.name,t.$watch("marque",function(e){e&&(t.models=JSON.parse(e).models)}),"new_cars"==a.current.name?e.get(n.url+"/new-cars").then(function(e){t.cars=e.data,t.totalItems=t.cars.length}):e.get(n.url+"/old-cars").then(function(e){t.cars=e.data,t.totalItems=t.cars.length}),t.currentPage=1,t.maxSize=5,t.$watch("itemsPerPage",function(e){t.currentPage=1}),t.setPage=function(e){t.currentPage=e},t.setPage(t.currentPage),t.pageChanged=function(){t.setPage(t.currentPage),$("html, body").animate({scrollTop:0},1e3)},t.searchCar=function(){t.marque&&(t.search.marque=JSON.parse(t.marque).nom),a.go("search",t.search,{reload:!0})}}]).controller("searchController",["$scope","$state","$stateParams","$http","API_ENDPOINT",function(t,e,n,a,r){a.get(r.url+"/marques").then(function(e){t.marques=e.data}),t.zone=e.current.name,a.get(r.url+"/search",{params:n}).then(function(e){t.cars=e.data,t.totalItems=t.cars.length,t.search=null,t.search={price:"0,200000",marque:"",model:"",year:"",transmission:"",condition:""}}),t.itemsPerPage=9,t.currentPage=1,t.maxSize=5,t.$watch("itemsPerPage",function(e){t.currentPage=1}),t.setPage=function(e){t.currentPage=e},t.setPage(t.currentPage),t.pageChanged=function(){t.setPage(t.currentPage),$("html, body").animate({scrollTop:0},1e3)},t.$watch("marque",function(e){e&&(t.models=JSON.parse(e).models)}),t.searchCar=function(){t.marque&&(t.search.marque=JSON.parse(t.marque).nom),e.go(e.current,t.search,{reload:!0})}}]),app.directive("drange",function(){function t(t,e){for(var n=[],a=t;a<=e;a++)n.push(a);return n}return{restrict:"A",replace:!0,template:'<select ><option value="">{{"HOME_SEARCH_FORM_YEAR"|translate}}</option><option ng-repeat="n in number track by $index" value="{{n}}">{{n}}</option></select>',controller:["$scope",function(t){t.scrollToTop=function(){$("html, body").animate({scrollTop:0},900)}}],link:function(e,n,a){"to"in a?e.number=t(a.from,a.to):e.number=t(a.from,(new Date).getFullYear())}}}).directive("clock",["$interval",function(t){return{restrict:"E",$scope:{},template:' <div class="widget widget-info widget-padding-sm"><div style="color: whitesmoke" class="widget-big-int plugin-clock">{{date|date:\'hh\'}}<span id="point">:</span>{{date|date:\'mm\'}}</div> <div class="widget-subtitle ">{{date|date:\'fullDate\'}}</div> <div class="widget-controls"> <a href="#" class="widget-control-right widget-remove" data-toggle="tooltip" data-placement="left" title="Remove Widget"><span class="fa fa-times"></span></a> </div> <div class="widget-buttons widget-c3"> <div class="col"> <a href="#"><span class="fa fa-clock-o"></span></a> </div> <div class="col"> <a href="#"><span class="fa fa-bell"></span></a> </div> <div class="col"> <a href="#"><span class="fa fa-calendar"></span></a> </div> </div> </div>',link:function(e){e.date=Date.now(),t(function(){e.date=Date.now()},3e4)}}}]),app.service("authService",["$q","$http","API_ENDPOINT","$window",function(t,e,n,a){function r(){var t=a.localStorage.getItem(l);t&&s(t)}function o(t){window.localStorage.setItem(l,t),s(t)}function s(t){u=!0,c=t,e.defaults.headers.common.Authorization=c}function i(){c=void 0,u=!1,e.defaults.headers.common.Authorization=void 0,window.localStorage.removeItem(l)}var c,l="user_token",u=!1,d=function(a){return t(function(t,r){e.post(n.url+"/auth/login",a).then(function(e){e.data.success?(o(e.data.token),t(e.data.msg)):r(2)})})},m=function(){i()},p=function(t){e.get(n.url+"/user/getInformation").then(function(e){t(e.data.user)})};return r(),{storeUserCredentials:o,login:d,logout:m,getUser:p,isAuthenticated:function(){return u}}}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(t,e,n){return{responseError:function(a){return t.$broadcast({401:n.notAuthenticated}[a.status],a),e.reject(a)}}}]).config(["$httpProvider",function(t){t.interceptors.push("AuthInterceptor")}]),app.filter("timeago",function(){return function(t,e,n){if("ar"!=e)var a={prefixAgo:null,prefixFromNow:null,suffixAgo:null,suffixFromNow:null,seconds:"moins d'une minute",minute:"environ une minute",minutes:"depuis %d minutes",hour:"environ une heure",hours:"depuis %d heures",day:"il y a un jour",days:"depuis %d jours",month:"environ un mois",months:"depuis %d mois",year:"environ un ans",years:"depuis %d anneés"};else a={prefixAgo:null,prefixFromNow:null,suffixAgo:"منذ",suffixFromNow:"من الان",seconds:"أقل من دقيقة",minute:"حوالي دقيقة",minutes:"%d دقائق",hour:"حوالي ساعة",hours:"حوالي %d ساعات",day:"يوم",days:"%d ايام",month:"شهر تقريبا",months:"%d أشهر",year:"حوالي سنة",years:"%d سنوات"};var r,o=function(t,e,n){var a=$.isFunction(t)?t(e,l):t,r=n.numbers&&n.numbers[e]||e;return a.replace(/%d/i,r)},s=(new Date).getTime(),i=new Date(t).getTime(),c=n||!1,l=s-i,u=Math.abs(l)/1e3,d=u/60,m=d/60,p=m/24,g=p/365,h=void 0===a.wordSeparator?" ":a.wordSeparator,f=a.prefixAgo,E=a.suffixAgo;return c&&l<0&&(f=a.prefixFromNow,E=a.suffixFromNow),r=u<45&&o(a.seconds,Math.round(u),a)||u<90&&o(a.minute,1,a)||d<45&&o(a.minutes,Math.round(d),a)||d<90&&o(a.hour,1,a)||m<24&&o(a.hours,Math.round(m),a)||m<42&&o(a.day,1,a)||p<30&&o(a.days,Math.round(p),a)||p<45&&o(a.month,1,a)||p<365&&o(a.months,Math.round(p/30),a)||g<1.5&&o(a.year,1,a)||o(a.years,Math.round(g),a),"ar"==e?$.trim([E,r,f].join(h)):$.trim([f,r,E].join(h))}});